## Process this file with automake to produce Makefile.in

ACLOCAL_AMFLAGS = -I m4

SUBDIRS = lpc10 libgsm src
DIST_SUBDIRS = lpc10 libgsm src

RM = rm -f

# man pages are not considered to be sources, so need to add "dist_"
# prefix to ensure they are added to the distribution.
dist_man_MANS = sox.1 soxi.1 soxeffect.7 soxformat.7 libsox.3
EXTRA_DIST = sox.txt soxi.txt soxeffect.txt soxformat.txt libsox.txt CMakeLists.txt sox.pc.in

if HAVE_PKGCONFIG
pkgconfigdir = @PKGCONFIGDIR@
pkgconfig_DATA = sox.pc
endif

play.1 rec.1: sox.1
	$(RM) $@ && $(LN_S) $< $@

# Rule for making text man pages
.1.txt .3.txt .7.txt:
	tbl $(srcdir)/$< | nroff -man | col -b > $@

txt: sox.txt soxi.txt soxeffect.txt soxformat.txt libsox.txt

# Rule for making PDF man pages
.1.pdf .3.pdf .7.pdf:
	tbl $(srcdir)/$< | groff -man -Tps | ps2pdf - $@

pdf: sox.pdf soxi.pdf soxeffect.pdf soxformat.pdf libsox.pdf

# Rule for making HTML man pages
#
# Parts of sed expressions were borrowed from smartmontool's Makefile.am.
# Get rid of unneeded Content-Type and convert filenames from default
# cgi-bin format to relative filenames (similar to -r option) but
# with custom names we prefer.
#
FIXHTML = sed '1s,^Content-type.*,,' | \
	  sed 's,<A HREF="http://[-a-z/]*/man2html?\([1-8]\)+\([.a-z]*\)">,<A HREF="\2.html">,g' | \
	  sed 's,<A HREF="http://[-a-z/]*/man2html">,<A HREF=".">,g'

.1.html .3.html .7.html:
	man2html $(srcdir)/$< | $(FIXHTML) > $@

html: sox.html soxi.html soxeffect.html soxformat.html libsox.html

install-data-hook:
	cd $(DESTDIR)$(mandir)/man1 && $(RM) play.1 && $(LN_S) sox.1 play.1
	cd $(DESTDIR)$(mandir)/man1 && $(RM) rec.1 && $(LN_S) sox.1 rec.1

uninstall-hook:
	$(RM) $(DESTDIR)$(mandir)/man1/play.1
	$(RM) $(DESTDIR)$(mandir)/man1/rec.1

# Automatically update libtool script if it gets out-of-date
libtool: $(LIBTOOL_DEPS)
	$(SHELL) ./config.status --recheck
